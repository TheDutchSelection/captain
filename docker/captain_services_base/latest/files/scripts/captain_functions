#!/bin/bash
# DESCRIPTION: Helper with functions used by captain scripts
# DEPENDENCIES: etcd_helper
# REQUIRED ENVS: 
# OPTIONAL ENVS:
# USAGE:
# EXAMPLE:
set -e

# include dependencies
dir="${BASH_SOURCE%/*}"
if [[ ! -d "$dir" ]]; then dir="$PWD"; fi
. "$dir/etcd_helper"

# $1: file_path
# $2: file name
get_file_path_including_file_name () {
  local file_path="$1"
  local file_name="$2"
  echo "$file_path$file_name"
}

# $1: file_path
# $2: file name
create_empty_file () {
  local file_path="$1"
  local file_name="$2"
  mkdir -p "$file_path"
  cat /dev/null > "$(get_file_path_including_file_name $file_path $file_name)"
}

# $1: etcd_key_value (ie. /tds/doa3/containers/test/1/key="aap"
# $2: strip (ie. /tds/doa3/containers/)
create_env_from_etcd_key_value () {
  etcd_key_value="$1"
  strip="$2"

  local stripped_etcd_key_value=${etcd_key_value/"$strip"/}
  local stripped_etcd_key_value_unquoted=${stripped_etcd_key_value//\"/}
  local key="$(echo $stripped_etcd_key_value_unquoted | awk -F'=' '{print $1}')"
  local value="$(echo $stripped_etcd_key_value_unquoted | awk -F'=' '{print $2}')"

  local key="$(echo $key | awk '{print toupper($0)}')"
  local key=${key//\//_}
  local key=${key//\-/_}
  echo "$key=$value"
}